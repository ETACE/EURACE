#include "CUnit/Basic.h"
//#include "../../header.h"
#include "../../Household_agent_header.h"
#include "../my_library_header.h"

/************Household Role: Financial Market********************************/

/************ Unit tests ********************************/

	void unittest_Household_select_strategy()
	{
//	    /************* At start of unit test, add one agent **************/
		//add_Bank_agent_internal(init_Bank_agent(), init_Bank_state());
		//current_xmachine = *p_xmachine;
		int rc;
	    Stock *stock1;
		double local_prices[100] = {49.997339, 50.000000, 50.002052, 50.002779, 50.001165, 50.000643, 50.001666, 50.001143, 50.000546, 50.001581, 50.001811, 50.002362, 50.002650, 50.002339, 50.001161, 50.001498, 50.003220, 50.000736, 50.000935, 50.001899, 50.003607, 50.002962, 50.002132, 50.000624, 50.001427, 50.002124, 50.002228, 50.001788, 50.003076, 50.003209, 50.003908, 50.005125, 50.004121, 50.004935, 50.004506, 50.003909, 50.002093, 50.003110, 50.002826, 50.003502, 50.003130, 50.004297, 50.004107, 50.005375, 50.004044, 50.004615, 50.004744, 50.004613, 50.006407, 50.006982, 50.006615, 50.007113, 50.007146, 50.007407, 50.006722, 50.007446, 50.008933, 50.008155, 50.007089, 50.008348, 50.007558, 50.006761, 50.007386, 50.006673, 50.007563, 50.006054, 50.005134, 50.004931, 50.005194, 50.006676, 50.005593, 50.004873, 50.005295, 50.005825, 50.005003, 50.003667, 50.002730, 50.001421, 50.001017, 50.001818, 50.001303, 50.001273, 49.999353, 49.998723, 49.998717, 49.996858, 49.996570, 49.996231, 49.997438, 49.997229, 49.997528, 49.995753, 49.996837, 49.996912, 49.997733, 49.998112, 49.997963, 49.996709, 49.994766, 49.996143};
		double local_returns[100] = {0.000024, 0.000053, -0.000010, 0.000015, -0.000032, -0.000010, 0.000020, -0.000010, -0.000012, 0.000021, 0.000005, 0.000011, 0.000006, -0.000006, -0.000024, 0.000007, 0.000034, -0.000050, 0.000004, 0.000019, 0.000034, -0.000013, -0.000017, -0.000030, 0.000016, 0.000014, 0.000002, -0.000009, 0.000026, 0.000003, 0.000014, 0.000024, -0.000020, 0.000016, -0.000009, -0.000012, -0.000036, 0.000020, -0.000006, 0.000014, -0.000007, 0.000023, -0.000004, 0.000025, -0.000027, 0.000011, 0.000003, -0.000003, 0.000036, 0.000012, -0.000007, 0.000010, 0.000001, 0.000005, -0.000014, 0.000014, 0.000030, -0.000016, -0.000021, 0.000025, -0.000016, -0.000016, 0.000012, -0.000014, 0.000018, -0.000030, -0.000018, -0.000004, 0.000005, 0.000030, -0.000022, -0.000014, 0.000008, 0.000011, -0.000016, -0.000027, -0.000019, -0.000026, -0.000008, 0.000016, -0.000010, -0.000001, -0.000038, -0.000013, -0.000000, -0.000037, -0.000006, -0.000007, 0.000024, -0.000004, 0.000006, -0.000036, 0.000022, 0.000002, 0.000016, 0.000008, -0.000003, -0.000025, -0.000039, 0.000028};
		unittest_init_Household_agent();
//
//		/***** Variables: Memory pre-conditions **************************/
//		<var_name1>=0.0;
//		<var_name2>=0;

        
        ID = 1;
        PAYMENT_ACCOUNT = 5000;
        FORWARDWINDOW = 20;
        BACKWARDWINDOW = 5;
        CURRENTDAY = 15;
        RANDOMWEIGHT = 1;
        FUNDAMENTALWEIGHT = 0;
        CHARTISTWEIGHT = 0;
        BINS = 1;
        LOSSAVERSION = 2.25;
        
        
        stock1->id = 1;
        stock1->index = 0;
        stock1->nrOutStandingShares = 300;


       // copy_double_array(local_prices, stock1->prices);
       // copy_double_array(local_returns, stock1->returns);

//        stock2->id = 2;
//        stock->index = 0;
//        stock2->nrOutStandingShares = 100;
//        stock2->prices = {58.7279202185,53.828982342,48.9456680024,51.0197541662,48.8027910471,51.8243696053,55.0891772942,49.0846249729,51.8816890282,51.7414177729,43.5551656964,54.1107541326,53.8970227679,45.4389406002,52.7123129578,47.7413115608,49.4597393534,51.9789465611,46.042618338,49.5691914308,48.688152658,50.1219192118,46.3699170725,59.9789184468,44.9421396811,57.6364926951,50.8713024113,47.6233256331,50.0113269174,48.5985158169,55.4548920603,48.2148465827,51.1742950589,54.4172240599,45.2423727384,52.9992461704,50.5937272192,49.1997288727,50.4221455828,44.3098592572,56.3378972526,56.1193217131,53.2862400115,50.2711040872,56.6076522236,47.6444882876,49.6798678266,49.102443921,56.8610125273,49.4603742746,47.7113090899,56.6614370749,43.3080852106,55.9352429404,58.4187728971,56.0437447812,46.783061091,47.2978695636,45.7565300393,49.4353582691,43.6955856191,55.569376916,49.7690139866,49.6188775344,50.6759387117,53.8496174377,54.2113682395,48.4642361343,43.4008808029,45.0342004019,51.3537507293,46.9052738276,47.8213028437,52.0243422186,50.4610073984,51.892732834,43.5960227413,55.9818600185,47.9817432076,51.8343507877,56.0976748504,56.6069799639,50.9891185026,47.0098597691,45.148751247,66.1611256729,50.0116258434,53.8020670765,57.399494065,40.9034701537,45.2323765399,59.039632942,51.1936309207,51.3659041743,43.3108059227,49.3784060623,51.5068686219,58.1911587137,45.3096254456,43.2604909988};
//        stock2->returns = {0.242000717182,1.12817718631,1.00414383256,1.37189477821,-1.02771463643,-4.2575855794,1.05653453037,0.112411064474,-0.884064076487,2.58425430968,1.95440357052,0.808465701476,-1.28413446548,-1.98238204052,1.0600004657,0.00776236413826,2.89456985703,-0.884087586743,-2.79108014133,2.49933238932,0.0523955018682,-1.16735909205,-1.6002178961,0.631763193737,0.12979324573,4.19117120346,-3.59239358078,-0.468855829872,2.22020171461,-0.504881241115,-1.08231570176,2.12505837326,0.327021015537,0.0862501044734,0.4416658526,1.37978415218,0.87434471154,-2.21205507558,-0.806972784272,-1.22788793116,-2.83205928821,0.121831977603,3.28170182215,0.307312755644,-3.80664203288,-1.89696771775,0.980637082181,-0.100768280396,1.61965198991,-1.79591198071,-1.53533456187,-1.66608018904,-0.0760596385509,2.36771184588,-0.604613427023,0.802813333044,-0.678605397444,-1.92681690356,2.82114490382,2.85331889466,-2.52748357407,-1.15418614761,3.51271977861,-0.480238356458,1.83576910542,-2.93636671337,-0.850702117138,-1.40132382452,0.15284826819,2.67436936331,-3.03285465021,-1.24245047835,-0.966707882565,1.25548406411,0.889043711629,0.560696957798,2.92628725348,-2.9756589514,-3.05277545941,2.05413922604,-2.28960819946,-1.58649438743,-0.934524976709,-3.94314545859,-1.65551753387,-0.933931289382,3.31263140046,-0.509717496666,-0.254628852491,0.150508317118,-0.872341859886,-4.09027683142,0.606378096104,-1.48655270247,0.125975197161,-3.48502412297,0.342189352764,-0.489380952745,2.17865148269,0.381140281836};
        
        add_Asset(&ASSETSOWNED, 1, 500, 49.997339);
                
        
        rc = MB_Create(b_info_firm, sizeof(m_info_firm));

	    #ifdef ERRCHECK
	    if (rc != MB_SUCCESS)
	    {
	       fprintf(stderr, "ERROR: Could not create 'info_firm' board\n");
	       switch(rc) {
	           case MB_ERR_INVALID:
	               fprintf(stderr, "\t reason: Invalid message size\n");
	               break;
	           case MB_ERR_MEMALLOC:
	               fprintf(stderr, "\t reason: out of memory\n");
	               break;
	           case MB_ERR_INTERNAL:
	               fprintf(stderr, "\t reason: internal error. Recompile libmoard in debug mode for more info \n");
	               break;
	       }
	    }
	    #endif
        	    
        	    

//
//      /***** Messages: pre-conditions **********************************/
//		add_loan_request_message(50,10,5,2,1);
//
//		add_info_firm_message(int id, double earnings, double dividend, double earnings_payout, double equity, Stock stock)  
        
        add_info_firm_message(1, 1000, 100, 300, 100000, *stock1);
        

        
		rc = MB_Iterator_Create(b_info_firm, &i_info_firm);
				
		if (rc != MB_SUCCESS)
				{
                   
				   fprintf(stderr, "ERROR: Could not create Iterator for 'info_firm'\n");
				   switch(rc) {
				       case MB_ERR_INVALID:
				           fprintf(stderr, "\t reason: 'info_firm' board is invalid\n");
				           break;
				       case MB_ERR_LOCKED:
			               fprintf(stderr, "\t reason: 'info_firm' board is locked\n");
			               break;
			           case MB_ERR_MEMALLOC:
			               fprintf(stderr, "\t reason: out of memory\n");
			               break;
			           case MB_ERR_INTERNAL:
			               fprintf(stderr, "\t reason: internal error. Recompile libmoard in debug mode for more info \n");
			               break;
				   }
				}
		
//		add_info_firm_message(1, 1000, 100, 300, 100000, *stock1);
		
				
				
//	    /***** Function evaluation ***************************************/
        Household_select_strategy();
//	    
//	    /***** Variables: Memory post-conditions *************************/
//		CU_ASSERT_DOUBLE_EQUAL(<var_name1>, <value>, 1e-3);
//		CU_ASSERT_EQUAL(<var_name2>, <value>);
//		
//     /***** Messages: post-conditions **********************************/
//        START_ORDER_MESSAGE_LOOP
//	    	//CU_ASSERT_DOUBLE_EQUAL(order_message->......., <value>);
//	 		CU_ASSERT_EQUAL(order_message->trader_id, 1);
//	 		CU_ASSERT_EQUAL(order_message->asset_id, 1); 
//	 		CU_ASSERT_DOUBLE_EQUAL(order_message->limit_price, 50.001810897942924741, 0.000001);
//	 		CU_ASSERT_EQUAL(order_message->quantity, 700);
//		FINISH_ORDER_MESSAGE_LOOP

//	
//	    /************* At end of unit test, free the agent **************/
	    //free_agent();
		unittest_free_Household_agent();
//     /************* At end of unit tests, free all Messages **********/
	    //free_messages();
	    MB_Clear(b_order);
   	    MB_Clear(b_order_status);
   	    MB_Clear(b_infoAssetCH);
   	    MB_Clear(b_info_firm);
	}
